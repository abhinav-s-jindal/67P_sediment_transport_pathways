# Comet 67P Sediment Transport Pathways

[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.17574889.svg)](https://doi.org/10.5281/zenodo.17574889)

## Overview

This repository contains code and data for analyzing sediment redistribution pathways on comet 67P/Churyumov-Gerasimenko through ballistic transport simulations. The analysis examines how particles move across the comet's surface via gravitational ejection and landing cycles, providing insights into surface evolution processes on small celestial bodies.

**Associated Publication:**  
[Citation information will be added upon publication in Science Advances]

**Author:** Abhinav S. Jindal

---

## Repository Contents

### Directories

#### `obj_files/`
3D shape model of comet 67P used for all simulations and visualizations.
- **File:** `CG_s7v1_10Km_16m_13M_B_INLET.obj`
- **Format:** Wavefront OBJ (ASCII)
- **Specifications:** 220,300 vertices, 440,596 faces, ~10m resolution

#### `ejection_probability_maps/`
Normalized ejection probability distributions derived from erosion data (Groussin et al. 2025).
- **Files:**
  - `CG_s7v1_10Km_16m_13M_B_INLET_ejection_probability.txt` - Plain text format
  - `CG_s7v1_10Km_16m_13M_B_INLET_ejection_probability.vtk` - VTK format for visualization
- **Reference:** https://doi.org/10.1051/0004-6361/202452260

#### `transport_dict_files/`
**⚠️ Large Data Files - Available on Zenodo**

Pre-computed ballistic transport dictionaries for 9 velocities (0.1-0.9 m/s).
- **Files:** `transport_dict_velocity_0x_shapemodel.pkl` (x = 1 to 9)
- **Download from:** https://doi.org/10.5281/zenodo.17574912
- **Size:** ~5 GB total
- **Note:** Place downloaded files in this directory before running analysis scripts

### Python Scripts

#### 1. `create_hop_stats.py`
**Purpose:** Multi-hop sediment redistribution simulation  
**Input:**
- Transport dictionaries (from `transport_dict_files/`)
- Ejection probability map (from `ejection_probability_maps/`)
- Shape model (from `obj_files/`)

**Output:** 
- Text files with particle distributions per iteration
- Saved to: `particle_distribution_outputs/v0x/txts/`

**Usage:**
```bash
python create_hop_stats.py
# Enter velocity (0.1-0.9 m/s) when prompted
# Enter number of hops when prompted
```

#### 2. `convert_hop_stats_to_vtk.py`
**Purpose:** Convert particle distribution text files to VTK format for visualization  
**Input:**
- Particle distribution text files (output from `create_hop_stats.py`)
- Shape model (from `obj_files/`)

**Output:**
- VTK files for ParaView visualization (https://www.paraview.org/)
- Saved to: `particle_distribution_outputs/v0x/vtk/`

**Usage:**
```bash
python convert_hop_stats_to_vtk.py
# Enter velocity (0.1-0.9 m/s) when prompted
```

**Note:** Run `create_hop_stats.py` first to generate input data.

#### 3. `generate_spatial_index.py`
**Purpose:** Generate KDTree spatial index for interactive visualization  
**Input:**
- Shape model (from `obj_files/`)

**Output:**
- `cell_spatial_index.pkl` - Spatial index for fast facet queries

**Usage:**
```bash
python generate_spatial_index.py
```

**Note:** Run this once before using `trajectory_source_visualizer.py`.

#### 4. `trajectory_source_visualizer.py`
**Purpose:** Interactive tool for reverse trajectory analysis  
**Input:**
- Spatial index (`cell_spatial_index.pkl` - generated by `generate_spatial_index.py`)
- Transport dictionaries (from `transport_dict_files/`)
- Shape model (from `obj_files/`)

**Output:**
- CSV files with selected targets and source contributions

**Usage:**
```bash
python trajectory_source_visualizer.py
# Enter velocity (0.1-0.9 m/s) when prompted
```

**Interactive Controls:**
- `p` - Toggle target selection mode
- `c` - Clear selected targets
- `v` - Calculate and visualize source contributions
- `r` - Reset visualization
- `[` / `]` - Decrease/increase brush size
- `s` - Save selection to CSV

**Note:** Requires VTK and GUI support. Run `generate_spatial_index.py` first.

---

## Quick Start Guide

### Installation

1. **Clone the repository:**
```bash
git clone https://github.com/yourusername/67P_sediment_transport_pathways.git
cd 67P_sediment_transport_pathways
```

2. **Install dependencies:**
```bash
pip install numpy scipy vtk pickle-mixin
```

3. **Download large data files from Zenodo:**
   - Visit: [Zenodo link will be added]
   - Download all `transport_dict_velocity_*.pkl` files
   - Place them in the `transport_dict_files/` directory

### Workflow

#### For Multi-Hop Sediment Analysis:
```bash
# Step 1: Run multi-hop simulation
python create_hop_stats.py
# Enter velocity: 0.5
# Enter number of hops: 10

# Step 2: Convert results to VTK for visualization
python convert_hop_stats_to_vtk.py
# Enter velocity: 0.5

# Step 3: Open VTK files in ParaView
# Files located in: particle_distribution_outputs/v05/vtk/
```

#### For Interactive Source Analysis:
```bash
# Step 1: Generate spatial index (run once)
python generate_spatial_index.py

# Step 2: Launch interactive visualizer
python trajectory_source_visualizer.py
# Enter velocity: 0.5

# Step 3: Use interactive controls to:
#   - Select target regions (press 'p', then click/drag)
#   - Visualize contributing sources (press 'v')
#   - Save results (press 's')
```

---

## Methodology

### Simulation Approach

The analysis uses a two-phase processing algorithm to model iterative particle redistribution:

1. **Phase 1 (Read):** Calculate all particle ejections from current distribution
2. **Phase 2 (Write):** Apply all transfers simultaneously

This approach ensures particle conservation and eliminates order-dependency issues.

### Initial Conditions

- Each facet initialized with particles proportional to its outgoing connectivity
- Particles ejected according to normalized erosion-based probabilities
- Transport follows pre-computed ballistic trajectories (gravity only)

### Iterations

Simulations run for a user-specified number of iterations.

---

## Data Format Specifications

### Transport Dictionaries (PKL)
```python
{
    source_facet_id: {
        'destination_facets': [dest_id_1, dest_id_2, ..., dest_id_n]
    },
    ...
}
```
- Facet IDs are 0-indexed
- Destination list may contain repeats (multiple particles to same destination)

### Particle Distribution Files (TXT)
- One value per line (440,596 lines total)
- Line number corresponds to facet ID
- Values are floating-point particle counts

### VTK Files
- ASCII PolyData format
- Cell data contains particle counts as scalar field
- Compatible with ParaView, VisIt, and other VTK viewers

---

## Visualization

### ParaView Workflow
ParaView (https://www.paraview.org/) is recommended for viewing VTK output files.

1. Open VTK file in ParaView
2. Select "particle_count" for coloring
3. Recommended colormap: Cool to Warm on log-scale
4. Use white background for publication-quality figures
5. Apply "Surface" representation

### Multi-View Comparisons

Use the included scripts to generate multi-hop comparison views showing particle redistribution evolution over iterations.

---

## Citation

If you use this code or data in your research, please cite:
```bibtex
[Citation will be added upon publication]
```

And the source erosion data:
```bibtex
@article{groussin_thermal_2025,
    title = {Thermal environment and erosion of comet {67P}/{Churyumov}-{Gerasimenko}},
    volume = {694},
    copyright = {https://creativecommons.org/licenses/by/4.0},
    issn = {0004-6361, 1432-0746},
    doi = {10.1051/0004-6361/202452260},
    journal = {Astronomy \& Astrophysics},
    author = {Groussin, O. and Jorda, L. and Attree, N. and Birch, S. P. D. and Bürger, J. and Gutiérrez, P. and Jindal, A. S. and Keller, H. U. and Kramer, T. and Manghi, R. Lasagni and Läuter, M. and Markkanen, J. and Marschall, R. and Schuckart, C.},
    month = feb,
    year = {2025},
    pages = {A21},
}
```

---

## Requirements

- Python 3.7+
- NumPy
- SciPy (for KDTree)
- VTK (for visualization tools)
- pickle

For interactive visualizer:
- VTK with GUI support
- Display/X11 forwarding if running remotely

---

## Data Availability

- **GitHub:** Code and small data files (<100 MB)
  - Repository: https://github.com/yourusername/67P_sediment_transport_pathways
- **Zenodo - Code Repository:** https://doi.org/10.5281/zenodo.17574889
- **Zenodo - Transport Dictionaries:** https://doi.org/10.5281/zenodo.17574912
  - Total size: ~5 GB

---

## License

CC-BY-4.0

---

## Contact

For questions or issues, please:
- Open an issue on GitHub
- Contact: abhinav_jindal@brown.edu

---

## Acknowledgments

Transport simulations were performed using the DRAG3D code (Marschall et al. 2016, https://doi.org/10.1051/0004-6361/201628085).

---

**Last Updated:** November 10th, 2025